#!/bin/bash



# Script to sum up DOS files from VASP
if [ $# -eq 1 ]; then
	echo "energy, tot+, tot-, s+, s-, p+, p-, d+, d-, s+, s-, px+, px-, py+, py-, pz+, pz-, dxy+, dxy-, dyz+, dyz-, dxz+, dxz-, dx2-y2+, dx2-y2-, dz2+, dz2-," > DOS.SUM.$1.csv
	awk '{if($1!~"#"){printf "%12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, %12.8f, \n", $1, $2+$4+$6+$8+$10+$12+$14+$16+$18, $3+$5+$7+$9+$11+$13+$15+$17+$19, $2 , $3 , $4+$6+$8 , $5+$7+$9 , $10+$12+$14+$16+$18, $11+$13+$15+$17+$19, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19 }}' DOS$1 >> DOS.SUM.$1.csv
	exit 0
elif [ $# -lt 3 ]; then

	echo "Usage: sum_dos [0] [start] [end]"
	echo "Or: sum_dos [1] [i] [j] [k] [l] ..."
	echo "energy tot+ tot- s+ s- p+ p- d+ d- s+ s- px+ px- py+ py- pz+ pz- dxy+ dxy- dyz+ dyz- dxz+ dxz- dx2-y2+ dx2-y2- dz2+ dz2-"
	exit 1
fi


type=$1
shift 1

# Contiguous
if [ $type -eq 0 ]; then

	start=$1
	end=$2
	shift 2
	string=$start.to.$end

	echo $start
	echo $end


# First file
	i=$start
	nl=$(wc -l DOS$i | awk '{print $1}')
echo $nl

	awk '{if($1!~"#"){printf "%12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f \n", $1, $2+$4+$6+$8+$10+$12+$14+$16+$18, $3+$5+$7+$9+$11+$13+$15+$17+$19, $2 , $3 , $4+$6+$8 , $5+$7+$9 , $10+$12+$14+$16+$18, $11+$13+$15+$17+$19, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19 }}' DOS$i > DOS.tmp

	i=$((i+1))

	while [ $i -le $end ]; do

		awk '{if($1!~"#"){printf "%12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f \n", $1, $2+$4+$6+$8+$10+$12+$14+$16+$18, $3+$5+$7+$9+$11+$13+$15+$17+$19, $2 , $3 , $4+$6+$8 , $5+$7+$9 , $10+$12+$14+$16+$18, $11+$13+$15+$17+$19, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19 }}' DOS$i  > DOS.tmp2

		paste DOS.tmp DOS.tmp2 | awk '{printf "%15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, \n",$1, $2+$29, $3+$30, $4+$31, $5+$32, $6+$33, $7+$34, $8+$35, $9+$36, $10+$37, $11+$38, $12+$39, $13+$40, $14+$41, $15+$42, $16+$43, $17+$44, $18+$45, $19+$46, $20+$47, $21+$48, $22+$49, $23+$50, $24+$51, $25+$52, $26+$53, $27+$54 }' > DOS.tmp3

		mv -f DOS.tmp3 DOS.tmp

		i=$((i+1))

	done


else

	start=$1
	shift 1

# First file
	i=$start
	nl=$(wc -l DOS$i | sed 's/://g' | awk '{print $1}')
	echo $nl

	awk '{if($1!~"#"){printf "%12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f \n", $1, $2+$4+$6+$8+$10+$12+$14+$16+$18, $3+$5+$7+$9+$11+$13+$15+$17+$19, $2 , $3 , $4+$6+$8 , $5+$7+$9 , $10+$12+$14+$16+$18, $11+$13+$15+$17+$19, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19 }}' DOS$i > DOS.tmp
	string=$start
	for i in "$@"; do

		echo $i
		string=$(echo $string.$i)
		awk '{if($1!~"#"){printf "%12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f %12.8f \n", $1, $2+$4+$6+$8+$10+$12+$14+$16+$18, $3+$5+$7+$9+$11+$13+$15+$17+$19, $2 , $3 , $4+$6+$8 , $5+$7+$9 , $10+$12+$14+$16+$18, $11+$13+$15+$17+$19, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19 }}' DOS$i  > DOS.tmp2

		paste DOS.tmp DOS.tmp2 | awk '{printf "%15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, %15.8f, \n", $1, $2+$29, $3+$30, $4+$31, $5+$32, $6+$33, $7+$34, $8+$35, $9+$36, $10+$37, $11+$38, $12+$39, $13+$40, $14+$41, $15+$42, $16+$43, $17+$44, $18+$45, $19+$46, $20+$47, $21+$48, $22+$49, $23+$50, $24+$51, $25+$52, $26+$53, $27+$54 }'  > DOS.tmp3

		mv -f DOS.tmp3 DOS.tmp
	done


fi

echo "energy, tot+, tot-, s+, s-, p+, p-, d+, d-, s+, s-, px+, px-, py+, py-, pz+, pz-, dxy+, dxy-, dyz+, dyz-, dxz+, dxz-, dx2-y2+, dx2-y2-, dz2+, dz2-," > DOS.SUM.$string.csv

cat DOS.tmp >>  DOS.SUM.$string.csv
rm -f DOS.tmp2 DOS.tmp



exit 0

